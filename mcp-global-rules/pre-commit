#!/bin/bash
# MCP Pre-commit Hook
# Auto-fix, risk check, security scan, review
set -e # Exit immediately if a command exits with a non-zero status.

echo "[MCP] Running pre-commit checks..."
# Use absolute path to avoid Windows Store alias issues
# Use generic python
# Use virtual environment python if available
if [ -f "./.venv/Scripts/python" ]; then
    PYTHON_CMD="./.venv/Scripts/python"
elif [ -f "./.venv/bin/python" ]; then
    PYTHON_CMD="./.venv/bin/python"
else
    PYTHON_CMD="python"
fi

$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py autocontext
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py record --snapshot
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py fix . --safe --apply
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py predict-bugs .
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py security .
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py review . --strict
