#!/bin/bash
# MCP Pre-push Hook
# Final quality gate
set -e # Exit immediately if a command exits with a non-zero status.

echo "[MCP] Running pre-push validation..."
# Use virtual environment python if available
if [ -f "./.venv/Scripts/python" ]; then
    PYTHON_CMD="./.venv/Scripts/python"
elif [ -f "./.venv/bin/python" ]; then
    PYTHON_CMD="./.venv/bin/python"
else
    PYTHON_CMD="python"
fi

$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py security .
$PYTHON_CMD mcp-global/mcp-global-rules/mcp.py architecture . --strict

# Git LFS
command -v git-lfs >/dev/null 2>&1 || { echo >&2 "\nThis repository is configured for Git LFS but 'git-lfs' was not found on your path. If you no longer wish to use Git LFS, remove this hook from your .git/hooks directory.\n"; exit 2; }
git lfs pre-push "$@"
